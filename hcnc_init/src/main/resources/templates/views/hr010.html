<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<!-- 추가 버튼 정의 -->
<th:block layout:fragment="additionalButtons">
    <button type="button" class="btn-excel">엑셀 다운로드</button>
    <button type="button" class="btn-print">출력</button>
    <button type="button" class="btn-approve">승인</button>
</th:block>

<!-- 검색 조건 커스터마이징 (필요한 경우) -->
<th:block layout:fragment="searchCondition">
    <div class="search-select">
        <p>성명</p>
        <input type="text" id="insertNM" name="insertNM" placeholder="성명(을)를 입력하세요">
    </div>
    <div class="search-input">
        <p>태그</p>
        <p class="fl-ac">
            <label for="tagInput"></label>
            <input type="text" id="tagInput" name="tags" th:value="${tagString}" placeholder="태그를 입력해주세요."/>
        </p>
    </div>
</th:block>

<!-- 실제 컨텐츠 영역 -->
<th:block layout:fragment="content">
    <div class="content">
        <div class="form-wrap">

            <h5>○ 인적사항 리스트</h5>

            <!-- Tabulator 테이블 영역 -->
            <div id="hr010Table"></div>

            <input type="hidden" id="dev_id" name="dev_id">
        </div>
    </div>

    <!-- Tagify -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css">
    <script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>

    <script>
        let table;

        function loadData() {
            const insertNM = $("#insertNM").val();
            console.log("insertNM =", insertNM);

            $.ajax({
                url: "/select_hr010",
                type: "GET",
                data: {
                    dev_nm: insertNM
                },
                success: function(response) {
                    console.log("요청 성공", response);

                    const list = response.res || [];

                    // Tabulator에 데이터 세팅
                    table.setData(list);
                },
                error: function(err) {
                    console.error(err);
                    alert("데이터 조회 중 오류가 발생했습니다.");
                }
            });
        }

        $(function() {

            // Tabulator 초기화
            table = new Tabulator("#hr010Table", {
                height: "500px",
                layout: "fitColumns",
                placeholder: "데이터가 존재하지 않습니다.",

                columns: [
                    { title: "성명", field: "dev_nm", hozAlign: "center", headerSort: true },
                    { title: "생년월일", field: "brdt", headerSort: true },
                    { title: "연락처", field: "tel" },
                    { title: "이메일", field: "email" },
                    { title: "거주지역", field: "region" },
                    { title: "주 개발언어", field: "main_lang" },
                    { title: "경력연차", field: "exp_yr", hozAlign: "center"},
                    { title: "최종학력", field: "edu_last" },
                    { title: "보유자격증", field: "cert_txt" },
                    { title: "희망단가", field: "hope_rate_amt", hozAlign: "right" },
                    { title: "투입가능시점", field: "avail_dt" },
                    { title: "계약형태", field: "ctrt_typ" }
                ],

                rowClick: function(e, row) {
                    const data = row.getData();
                    const devId = data.dev_id;

                    console.log("선택한 dev_id =", devId);

                    $("#dev_id").val(devId);

                    // 상세 페이지 이동
                    location.href = "/hr010/detail?dev_id=" + devId;
                }
            });

            // 최초 로딩
            loadData();

            // Tagify 초기화 (기존 코드 // 나중에 사용)
            const input = document.querySelector('#tagInput');
            if (input) {
                // 필요하면 활성화
                // const tagify = new Tagify(input, { maxTags: 1 });
            }
        });
    </script>

</th:block>

</html>